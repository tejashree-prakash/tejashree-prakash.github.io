---
title: "dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(plotly)
library(p8105.datasets)

#Load data - manually CSV and took a random sample of 150 values 
noaa <- read_csv("data/nynoaadat.csv", na=c("NA", ".", " "))
noaa <- noaa[sample(nrow(noaa), size = 150, replace = FALSE), ]
```


### Chart A: Time Series of Temperature Values 
```{r, echo=FALSE}
options(htmlwidgets.sizingPolicy = htmlwidgets::sizingPolicy(
  browser.fill = TRUE,
  defaultWidth = "100%",
  defaultHeight = "500px"
))

set.seed(123)

#Filter out rows with NA or 0 for tmax/tmin
valid_data <- noaa %>%
  filter(!is.na(tmax), tmax != 0,
         !is.na(tmin), tmin != 0)

#Randomly select 5 stations from valid data
stations <- sample(unique(valid_data$id), size = min(5, length(unique(valid_data$id))))

subset_data <- valid_data %>%
  filter(id %in% stations) %>%
  mutate(date = as.Date(date))

#Produce plot of temperature changes for selected stations
plot_ly(subset_data, x = ~date, y = ~tmax,
        color = ~id, type = "scatter", mode = "markers",
        marker = list(size = 10)) %>%
  add_trace(y = ~tmin, mode = "markers",
            marker = list(symbol = 'triangle-down', size = 10)) %>%
  layout(title = "Temperature Observations at Selected Stations",
         xaxis = list(title = "Date (year)"),
         yaxis = list(title = "Temperature (tenths of Â°C)"),
         legend = list(title = list(text = "Station ID")))
```


### Chart B: Distribution Chart of Precipitation
```{r, echo=FALSE}
options(htmlwidgets.sizingPolicy = htmlwidgets::sizingPolicy(
  browser.fill = TRUE,
  defaultWidth = "100%",
  defaultHeight = "500px"
))

#Visualize precipitation distribution by each weather station
precip_plot <- 
  plot_ly(noaa, x = ~id, y = ~prcp, type = "box") %>%
  layout(title = "Precipitation Distribution by Station",
         xaxis = list(title = "Station ID"),
         yaxis = list(title = "Precipitation (tenths of mm)"))
precip_plot
```


### Chart C - Scatterplot showing Snow Fall vs Snow Depth 
```{r, echo=FALSE}
options(htmlwidgets.sizingPolicy = htmlwidgets::sizingPolicy(
  browser.fill = TRUE,
  defaultWidth = "100%",
  defaultHeight = "500px"
))

#Filter out data that has NA for snow fall or snow depth 
filtered_data <- noaa %>%
  filter(!is.na(snow), !is.na(snwd))

stations_snow <- filtered_data %>%
  group_by(id) %>%
  filter(all(!is.na(snow)), all(!is.na(snwd))) %>%
  ungroup()

#Visualize snow fall vs snow depth 
snow_plot <- 
  plot_ly(stations_snow, 
        x = ~snow, 
        y = ~snwd, 
        type = "scatter", 
        mode = "markers",
        color = ~id, 
        text = ~paste("Station:", id, "<br>Date:", date)) %>%
  layout(title = "Snowfall vs Snow Depth in Stations with Snow Data",
         xaxis = list(title = "Snowfall (mm)"),
         yaxis = list(title = "Snow Depth (mm)"), 
                  legend = list(title = list(text = "Station ID"))
         )
snow_plot
```
<br><br>
Go back to the [homepage](index.html). 
