---
title: "dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(plotly)
library(p8105.datasets)
```


```{r}

noaa <- read_csv("data/nynoaadat.csv", na=c("NA", ".", " "))
noaa <- noaa[sample(nrow(noaa), size = 150, replace = FALSE), ]
```

### Chart A: Time Series of Temperature Values 
```{r}
#Show a time series between temperature values at one station

#Selecting 5 specific stations
stations <- c("USW00094794", "USW00014771", "USW00004725", "USC00304912", "USC00308906")
subset_data <- noaa %>%
  filter(id %in% stations, !is.na(tmax), !is.na(tmin))

subset_data$date <- as.Date(subset_data$date)

#Produce plot showing temp changes in each station
temp_changes <- plot_ly(subset_data, x = ~date, y = ~tmax,
                        color = ~id, type = "scatter", mode = "markers",
                        marker = list(size = 10)) %>%
  add_trace(y = ~tmin, mode = "markers", marker = list(symbol = 'triangle-down', size = 10)) %>%
  layout(title = "Temperature Observations at Selected Stations",
         xaxis = list(title = "Date (year)"),
         yaxis = list(title = "Temperature (tenths of Â°C)"),
         legend = list(title = list(text = "Station ID")))
temp_changes
```


### Chart B: Distribution Chart of Precipitation
```{r}
#Visualize precipitation distribution by each weather station
precip_plot <- 
  plot_ly(noaa, x = ~id, y = ~prcp, type = "box") %>%
  layout(title = "Precipitation Distribution by Station",
         xaxis = list(title = "Station ID"),
         yaxis = list(title = "Precipitation (tenths of mm)"))
precip_plot
```


### Chart C - Scatterplot showing Snow Fall vs Snow Depth 
```{r}
#Filter out data that has NA for snow fall or snow depth 
filtered_data <- noaa %>%
  filter(!is.na(snow), !is.na(snwd))

stations_snow <- filtered_data %>%
  group_by(id) %>%
  filter(all(!is.na(snow)), all(!is.na(snwd))) %>%
  ungroup()

#Visualize snow fall vs snow depth 
snow_plot <- 
  plot_ly(stations_snow, 
        x = ~snow, 
        y = ~snwd, 
        type = "scatter", 
        mode = "markers",
        color = ~id, 
        text = ~paste("Station:", id, "<br>Date:", date)) %>%
  layout(title = "Snowfall vs Snow Depth in Stations with Snow Data",
         xaxis = list(title = "Snowfall (mm)"),
         yaxis = list(title = "Snow Depth (mm)"), 
                  legend = list(title = list(text = "Station ID"))
         )
snow_plot
```

